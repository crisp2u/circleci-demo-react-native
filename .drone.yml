---
#kind: pipeline
#type: docker
#name: node
#
#platform:
#  os: linux
#  arch: amd64
#
#steps:
#  - name: restore-cache
#    image: drillster/drone-volume-cache
#    volumes:
#    - name: cache
#      path: /cache
#    settings:
#      restore: true
#      mount:
#        - .cache/yarn
#        - node_modules
#  - name: greeting
#    image: node:8
#    environment:
#      JEST_JUNIT_OUTPUT: test-results/jest/junit.xml
#    commands:
#      - yarn install --cache-folder .cache/yarn
#      - mkdir -p test-results/jest
#      - yarn run test
#  - name: rebuild-cache
#    image: drillster/drone-volume-cache
#    volumes:
#    - name: cache
#      path: /cache
#    settings:
#      rebuild: true
#      mount:
#        - .cache/yarn
#        - node_modules
#volumes:
#  - name: cache
#    host:
#      path: /tmp/caches

kind: pipeline
type: exec
name: macos

platform:
  os: darwin
  arch: amd64

steps:
  - name: setup ruby
    commands:
      - echo "ruby-2.4" > ~/.ruby-version
  - name: yarn
    environment:
      NVM_DIR: /Users/cristian.pop/.nvm
      PATH: "/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin:$PATH"
    commands:
      - chmod +x $NVM_DIR/nvm.sh && $NVM_DIR/nvm.sh
      #- system_profiler SPSoftwareDataType
      - $NVM_DIR/nvm.sh use 8.0
      - $NVM_DIR/nvm alias default 8.0
      - env
      - npm install -g yarn
      - yarn install --cache-folder .cache/yarn
  - name: bundle
    commands:
      - cd ios
      - bundle install


